name: Laravel Tests
on: [push]
jobs:
  laravel-tests:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Install Dependencies
      run: composer install

    - name: Copy .env
      run: php -r "file_exists('.env') || copy('.env.example', '.env');"

    - name: Set Environment Variables
      run: |
        echo DB_HOST=127.0.0.1 >> .env
        echo DB_PORT=3306 >> .env
        echo DB_DATABASE=laravel >> .env
        echo DB_USERNAME=root >> .env
        echo DB_PASSWORD=password >> .env

    - name: Build and run Docker Compose
      run: ./vendor/bin/sail up -d

    - name: Run tests
      run: ./vendor/bin/sail test
